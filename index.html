<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Korece Kelime Oyunu</title>
  <style>
    body {
      font-family: "Comfortaa", sans-serif;
      margin: 0; padding: 0;
      box-sizing: border-box;
      background: #fffaf5;
    }
    h1, h2, h3, p {
      margin: 0; padding: 0;
    }
    #start-screen, #quiz-screen {
      display: none;
      text-align: center;
      padding-top: 50px;
    }
    #start-screen.active, #quiz-screen.active {
      display: block;
    }
    .btn {
      background: #F7D9C4;
      border: 2px solid #FFC49A;
      border-radius: 12px;
      padding: 15px 30px;
      cursor: pointer;
      font-size: 20px;
      margin: 10px;
      transition: 0.2s;
    }
    .btn:hover {
      background: #ffcaa3;
    }
    #question-container {
      margin-top: 50px;
    }
    .answer-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin: 30px 0;
    }
    .answer-btn {
      background: #F7D9C4;
      border: 2px solid #FFC49A;
      border-radius: 30px;
      width: 200px;
      padding: 15px;
      cursor: pointer;
      font-size: 18px;
      transition: 0.2s;
      text-align: center;
    }
    .answer-btn:hover {
      background: #ffcaa3;
    }
    #wrong-answers {
      margin-top: 30px;
      width: 60%;
      margin-left: auto;
      margin-right: auto;
      border: 1px solid #FFC49A;
      border-radius: 10px;
      min-height: 100px;
      padding: 10px;
      background: rgba(247, 217, 196, 0.2);
    }
    #wrong-answers h3 {
      margin-bottom: 10px;
    }
    #top-bar {
      display: flex;
      justify-content: space-between;
      padding: 20px 40px;
      align-items: center;
    }
    #toggle-music {
      background: #F7D9C4;
      border: 1px solid #FFC49A;
      border-radius: 40px;
      width: 70px;
      height: 70px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    #question-counter {
      font-size: 24px;
    }
    #mode-label {
      margin-top: 20px;
      font-size: 32px;
      color: #9FD520;
      font-family: "Coiny", cursive;
    }
    #korean-word {
      font-size: 64px;
      color: #9CD713;
      margin: 30px 0;
    }
  </style>
</head>
<body>

<div id="start-screen" class="active">
  <h1 style="color:#9FD520; font-size:64px; font-family:'Coiny';">
    KORECE KELİME OYUNU
  </h1>
  <h2 style="color:#9CD713; margin:20px 0;">
    Başlamadan önce oyun modunu seç!
  </h2>
  <button id="kimbap-button" class="btn">Kimbap Modu (Kolay)</button>
  <button id="gocu-button" class="btn">Goçu Modu (Zor)</button>

  <!-- Müzik butonu örneği, istersen start screen'de de koyabilirsin -->
  <!-- <button id="toggle-music" class="btn">Müzik Aç/Kapa</button> -->
</div>

<div id="quiz-screen">
  <div id="top-bar">
    <button id="toggle-music">🔈</button>
    <div id="question-counter">1/20</div>
  </div>

  <h2 id="mode-label">Kimbap Modu</h2>
  
  <div id="question-container">
    <h1 id="korean-word">가게</h1>
    <div class="answer-buttons" id="answer-buttons"></div>
  </div>

  <button id="switch-mode-btn" class="btn">
    Kolay mı geldi? Biraz acı ekleyelim!
  </button>

  <div id="wrong-answers">
    <h3>Yanlış Cevaplar</h3>
    <ul id="wrong-list"></ul>
  </div>
</div>

<!-- Ses dosyaları (click, correct, wrong, music) -->
<audio id="click-sound" src="click.mp3"></audio>
<audio id="correct-sound" src="correct.mp3"></audio>
<audio id="wrong-sound" src="wrong.mp3"></audio>
<audio id="music-sound" src="music.mp3" loop></audio>

<script>
  // Örnek kelimeler dizisi (sen elindeki 1000 kelimeyi buraya ekleyebilirsin)
  const words = [
    { korean: "가격", turkish: "fiyat" },
    { korean: "가구", turkish: "mobilya" },
    { korean: "가깝다", turkish: "yakın olmak" },
    { korean: "가끔", turkish: "bazen" },
    { korean: "가다", turkish: "gitmek" },
    { korean: "가르치다", turkish: "öğretmek" },
    { korean: "가방", turkish: "çanta" },
    { korean: "가볍다", turkish: "hafif olmak" },
    { korean: "가수", turkish: "şarkıcı" },
    { korean: "가슴", turkish: "göğüs" },
    { korean: "가운데", turkish: "ortada" },
    { korean: "가을", turkish: "sonbahar" },
    { korean: "가장", turkish: "en çok" },
    { korean: "가져오다", turkish: "getirmek" },
    { korean: "가족", turkish: "aile" },
    { korean: "가지다", turkish: "sahip olmak" },
    { korean: "각", turkish: "her, her bir" },
    { korean: "간", turkish: "sırasında, esnasında" },
    { korean: "간호사", turkish: "hemşire" },
    { korean: "갈비", turkish: "kaburga" },
    // ... Devamı sende :)
  ];

  // DOM elementleri
  const startScreen = document.getElementById("start-screen");
  const quizScreen = document.getElementById("quiz-screen");
  const kimbapBtn = document.getElementById("kimbap-button");
  const gocuBtn = document.getElementById("gocu-button");
  const modeLabel = document.getElementById("mode-label");
  const questionCounter = document.getElementById("question-counter");
  const koreanWordEl = document.getElementById("korean-word");
  const answerButtonsEl = document.getElementById("answer-buttons");
  const switchModeBtn = document.getElementById("switch-mode-btn");
  const wrongList = document.getElementById("wrong-list");
  const toggleMusicBtn = document.getElementById("toggle-music");

  // Ses elementleri
  const clickSound = document.getElementById("click-sound");
  const correctSound = document.getElementById("correct-sound");
  const wrongSound = document.getElementById("wrong-sound");
  const musicSound = document.getElementById("music-sound");

  let mode = "kimbap"; // "kimbap" veya "gocu"
  let quizWords = []; // 20 tane rastgele seçilen kelimeler
  let currentQuestionIndex = 0;
  let wrongAnswers = []; // {korean, turkish} yanlışlar
  let lastTwoCorrectPositions = []; // doğru cevabın son 2 index'i (3 kere üst üste aynı olmaması için)

  // Rastgele diziyi karıştırma fonksiyonu
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Müzik aç/kapa
  let musicPlaying = false;
  function toggleMusic() {
    if (musicPlaying) {
      musicSound.pause();
      toggleMusicBtn.textContent = "🔈";
    } else {
      musicSound.play();
      toggleMusicBtn.textContent = "🔇";
    }
    musicPlaying = !musicPlaying;
  }

  toggleMusicBtn.addEventListener("click", () => {
    playClickSound();
    toggleMusic();
  });

  function playClickSound() {
    clickSound.currentTime = 0;
    clickSound.play();
  }
  function playCorrectSound() {
    correctSound.currentTime = 0;
    correctSound.play();
  }
  function playWrongSound() {
    wrongSound.currentTime = 0;
    wrongSound.play();
  }

  // Oyunu başlat
  function startGame(selectedMode) {
    mode = selectedMode;
    // Rastgele 20 kelime seç
    quizWords = shuffle([...words]).slice(0, 20);
    currentQuestionIndex = 0;
    wrongAnswers = [];
    wrongList.innerHTML = "";
    lastTwoCorrectPositions = [];

    // Ekranları ayarla
    startScreen.classList.remove("active");
    quizScreen.classList.add("active");

    updateModeUI();
    showQuestion();
  }

  // Mod etiketlerini ve düğme metnini güncelle
  function updateModeUI() {
    if (mode === "kimbap") {
      modeLabel.textContent = "Kimbap Modu (Kolay)";
      switchModeBtn.textContent = "Kolay mı geldi? Biraz acı ekleyelim!";
    } else {
      modeLabel.textContent = "Goçu Modu (Zor)";
      switchModeBtn.textContent = "Zor mu geldi? Kimbap’a dönelim!";
    }
  }

  // Soru göster
  function showQuestion() {
    const questionObj = quizWords[currentQuestionIndex];
    koreanWordEl.textContent = questionObj.korean;
    questionCounter.textContent = `${currentQuestionIndex + 1}/20`;

    // Şık sayısı mod'a göre
    const choiceCount = mode === "kimbap" ? 3 : 6;

    // Doğru cevabı ekle + random başka kelimeler ekle
    const answers = [questionObj.turkish];
    // Geri kalan 2 veya 5 şık için
    const others = shuffle(words.filter(w => w.turkish !== questionObj.turkish))
                   .slice(0, choiceCount - 1)
                   .map(item => item.turkish);
    answers.push(...others);

    // Cevapları karıştırmadan önce, doğru cevabın konumunu ayarlayacağız
    // "3 kere üst üste aynı index" olmaması için ufak bir fonksiyon yazalım
    const correctPos = getRandomCorrectPosition(choiceCount, lastTwoCorrectPositions);
    // Yani "answers" dizisinde 0. index'e doğru cevap koyacaksak, önce swap vs. yapalım
    // Şu an "answers[0]" doğru cevap, ama biz correctPos'a atacağız
    const correctAnswer = answers[0];
    // answers[0] ile answers[correctPos] yer değiştir
    [answers[0], answers[correctPos]] = [answers[correctPos], answers[0]];

    // lastTwoCorrectPositions güncelle
    lastTwoCorrectPositions.push(correctPos);
    if (lastTwoCorrectPositions.length > 2) {
      lastTwoCorrectPositions.shift(); // sadece son 2 taneyi tut
    }

    // Şimdi answers dizisini karıştırsaydık correctPos boşa giderdi.
    // Bu yöntemle direkt correctPos'a yerleştirmiş olduk.
    
    // Ekrana bas
    renderAnswerButtons(answers);
  }

  // Doğru cevabın 3 kere üst üste aynı index'te olmamasını sağlayan basit fonksiyon
  function getRandomCorrectPosition(choiceCount, lastPositions) {
    let pos;
    let tries = 0;
    do {
      pos = Math.floor(Math.random() * choiceCount);
      tries++;
      // son 2 pozisyona bak, ikisi de aynı ve pos da aynıysa tekrar dene
    } while (
      lastPositions.length === 2 &&
      lastPositions[0] === lastPositions[1] &&
      lastPositions[0] === pos &&
      tries < 100
    );
    return pos;
  }

  // Şık butonlarını oluşturma
  function renderAnswerButtons(answersArray) {
    answerButtonsEl.innerHTML = "";
    answersArray.forEach((answerText, index) => {
      const btn = document.createElement("button");
      btn.className = "answer-btn";
      btn.textContent = answerText;
      btn.onclick = () => handleAnswerClick(answerText);
      answerButtonsEl.appendChild(btn);
    });
  }

  // Şık tıklandığında
  function handleAnswerClick(selectedText) {
    playClickSound();
    const questionObj = quizWords[currentQuestionIndex];
    const correctAnswer = questionObj.turkish;

    if (selectedText === correctAnswer) {
      // Doğru
      playCorrectSound();
    } else {
      // Yanlış
      playWrongSound();
      // Yanlış listede yoksa ekle
      const alreadyWrong = wrongAnswers.some(
        (w) => w.korean === questionObj.korean
      );
      if (!alreadyWrong) {
        wrongAnswers.push({ korean: questionObj.korean, turkish: correctAnswer });
        const li = document.createElement("li");
        li.textContent = `${questionObj.korean} : ${correctAnswer}`;
        wrongList.appendChild(li);
      }
    }

    // Sonraki soruya geç
    currentQuestionIndex++;
    if (currentQuestionIndex >= quizWords.length) {
      // Oyun bitti
      alert("Quiz bitti!");
      // Yeniden başa dönebilirsin veya tekrar startGame() çağırabilirsin
      startScreen.classList.add("active");
      quizScreen.classList.remove("active");
    } else {
      showQuestion();
    }
  }

  // Mod değiştirme
  function switchMode() {
    mode = (mode === "kimbap") ? "gocu" : "kimbap";
    updateModeUI();
    // Mevcut soruda kaldık, sadece şık sayısını yeniden çizelim
    showQuestion();
  }

  // Event Listeners
  kimbapBtn.addEventListener("click", () => {
    playClickSound();
    startGame("kimbap");
  });
  gocuBtn.addEventListener("click", () => {
    playClickSound();
    startGame("gocu");
  });
  switchModeBtn.addEventListener("click", () => {
    playClickSound();
    switchMode();
  });

</script>

</body>
</html>
